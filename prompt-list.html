<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>PROMPOT</title>
  <link rel="icon" href="LogoImage_Prompot.png" type="image/png" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="include.js"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap');
    body {
      font-family: 'Noto Sans KR', sans-serif;
    }
    .edit-modal, .delete-confirm-modal {
      visibility: hidden;
      position: fixed;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(0,0,0,0.4);
      z-index: 1000;
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    .edit-modal.show, .delete-confirm-modal.show {
      visibility: visible;
      opacity: 1;
    }
    .edit-modal-content, .delete-confirm-modal-content {
      background: white;
      padding: 2rem;
      border-radius: 0.5rem;
      width: 90%;
      max-width: 600px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    select, input, textarea {
      width: 100%;
      padding: 0.5rem;
      margin-bottom: 1rem;
      border: 1px solid #d1d5db;
      border-radius: 0.375rem;
      font-family: inherit;
    }
    .category-box {
        display: block;
        width: 100%;
        padding: 0.75rem 1rem;
        margin-bottom: 0.5rem;
        border: 1px solid #e5e7eb; /* gray-200 */
        border-radius: 0.5rem; /* rounded-lg */
        background-color: #ffffff; /* white */
        text-align: center;
        font-weight: 500;
        color: #374151; /* gray-700 */
        transition: all 0.2s ease-in-out;
        cursor: pointer;
    }
    .category-box:hover {
        border-color: #fb923c; /* orange-400 */
        background-color: #fff7ed; /* orange-50 */
    }
    .category-box.active {
        border-color: #ea580c; /* orange-600 */
        background-color: #ea580c; /* orange-600 */
        color: #ffffff; /* white */
    }
    #searchInput::placeholder {
        text-align: center;
    }
  </style>
</head>

<body class="bg-orange-50 min-h-screen flex flex-col">
  <div data-include="navigation.html"></div>

  <!-- Layout: Sidebar + Main -->
  <div class="flex flex-grow max-w-7xl mx-auto w-full px-4">
    
    <!-- Sidebar -->
    <aside class="w-48 mr-6 hidden md:block pt-12">
      <h3 class="text-xl font-bold text-orange-600 mb-4 pb-2 border-b-2 border-orange-200 text-center">카테고리</h3>
      <!-- Search Input -->
      <div class="mb-4">
        <input type="text" id="searchInput" placeholder="프롬프트 검색" class="w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-orange-500 text-sm">
      </div>
      <div id="categoryList">
        <button class="category-box active" data-category="전체">전체</button>
        <button class="category-box" data-category="콘텐츠 작성">콘텐츠 작성</button>
        <button class="category-box" data-category="마케팅">마케팅</button>
        <button class="category-box" data-category="기술 문서">기술 문서</button>
        <button class="category-box" data-category="디자인">디자인</button>
        <button class="category-box" data-category="기타">기타</button>
      </div>
    </aside>

    <!-- Main -->
    <main class="flex-grow py-12 w-full">
      <h2 class="text-2xl font-bold text-gray-800 mb-8">생성된 프롬프트 목록</h2>
      <div id="promptList" class="grid grid-cols-1 md:grid-cols-2 gap-6"></div>
      <div id="pagination" class="flex justify-center mt-8 space-x-2"></div>
    </main>
  </div>

  <div data-include="footer.html"></div>

  <!-- Edit Modal -->
  <div id="edit-modal" class="edit-modal">
    <div class="edit-modal-content">
      <h3 class="text-xl font-bold mb-6 text-gray-800">프롬프트 수정</h3>
      <input type="hidden" id="edit-modal-index">
      <label for="edit-modal-title">프롬프트 제목</label>
      <input type="text" id="edit-modal-title" />
      <label for="edit-modal-desc">프롬프트 설명</label>
      <textarea id="edit-modal-desc" rows="3"></textarea>
      <label for="edit-modal-category">카테고리</label>
      <select id="edit-modal-category">
        <option value="콘텐츠 작성">콘텐츠 작성</option>
        <option value="마케팅">마케팅</option>
        <option value="기술 문서">기술 문서</option>
        <option value="디자인">디자인</option>
        <option value="기타">기타</option>
      </select>
      <label for="edit-modal-body">프롬프트 본문</label>
      <textarea id="edit-modal-body" rows="8" class="font-mono text-sm"></textarea>
      <div class="flex justify-end gap-3 mt-2">
        <button id="edit-modal-save-btn" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700">저장</button>
        <button id="edit-modal-cancel-btn" class="bg-gray-300 px-4 py-2 rounded-md">취소</button>
      </div>
    </div>
  </div>

  <!-- Delete Modal -->
  <div id="delete-confirm-modal" class="delete-confirm-modal">
    <div class="delete-confirm-modal-content text-center">
      <h3 class="text-lg font-semibold text-gray-800 mb-4">정말 삭제하시겠습니까?</h3>
      <p class="text-gray-600 mb-4">삭제된 프롬프트는 복구할 수 없습니다.</p>
      <p class="text-red-500 font-semibold" id="delete-modal-item-title"></p>
      <div class="flex justify-center gap-4 mt-4">
        <button id="delete-modal-confirm-btn" class="bg-red-600 text-white px-4 py-2 rounded-md">삭제</button>
        <button id="delete-modal-cancel-btn" class="bg-gray-300 px-4 py-2 rounded-md">취소</button>
      </div>
    </div>
  </div>

  <!-- View Modal -->
  <div id="view-modal" class="edit-modal">
    <div class="edit-modal-content">
      <h3 id="view-modal-title" class="text-2xl font-bold mb-4 text-orange-600"></h3>
      <p class="text-sm text-gray-500 mb-4"><strong>카테고리:</strong> <span id="view-modal-category"></span></p>
      <div class="mb-6">
          <h4 class="font-semibold text-gray-700 mb-2">설명</h4>
          <p id="view-modal-desc" class="text-gray-800 bg-gray-50 p-3 rounded-md whitespace-pre-wrap"></p>
      </div>
      <div>
          <h4 class="font-semibold text-gray-700 mb-2">프롬프트 본문</h4>
          <pre id="view-modal-body" class="w-full bg-yellow-50 text-gray-800 p-4 rounded-md font-mono text-sm whitespace-pre-wrap overflow-x-auto max-h-80"></pre>
      </div>
      <div class="flex justify-end gap-3 mt-6">
        <button id="view-modal-close-btn" class="bg-gray-300 px-4 py-2 rounded-md">닫기</button>
      </div>
    </div>
  </div>

  <!-- JavaScript 로직 -->
  <script>
    document.addEventListener('htmlIncluded', () => { // includeHTML 완료 후 실행
        // DOM Elements
        const promptListEl = document.getElementById('promptList');
        const categoryListEl = document.getElementById('categoryList');
        const searchInput = document.getElementById('searchInput');
        const paginationEl = document.getElementById('pagination');

        // Modals
        const editModal = document.getElementById('edit-modal');
        const editModalIndexInput = document.getElementById('edit-modal-index');
        const editModalTitleInput = document.getElementById('edit-modal-title');
        const editModalDescInput = document.getElementById('edit-modal-desc');
        const editModalCategoryInput = document.getElementById('edit-modal-category');
        const editModalBodyInput = document.getElementById('edit-modal-body');
        const editModalSaveBtn = document.getElementById('edit-modal-save-btn');
        const editModalCancelBtn = document.getElementById('edit-modal-cancel-btn');

        const viewModal = document.getElementById('view-modal');
        const viewModalTitle = document.getElementById('view-modal-title');
        const viewModalCategory = document.getElementById('view-modal-category');
        const viewModalDesc = document.getElementById('view-modal-desc');
        const viewModalBody = document.getElementById('view-modal-body');
        const viewModalCloseBtn = document.getElementById('view-modal-close-btn');

        const deleteConfirmModal = document.getElementById('delete-confirm-modal');
        const deleteModalItemTitle = document.getElementById('delete-modal-item-title');
        const deleteModalConfirmBtn = document.getElementById('delete-modal-confirm-btn');
        const deleteModalCancelBtn = document.getElementById('delete-modal-cancel-btn');
        let deleteIndex = null; // To store the index of the item to be deleted

        // State
        let allPrompts = [];
        let currentCategory = '전체';
        let searchTerm = '';
        let currentPage = 1;
        const itemsPerPage = 6;

        // --- Main Rendering Function ---
        const render = () => {
            // 1. Filter by category
            let filteredPrompts = allPrompts;
            if (currentCategory !== '전체') {
                filteredPrompts = allPrompts.filter(p => p.category === currentCategory);
            }

            // 2. Filter by search term
            if (searchTerm) {
                const lowerCaseSearchTerm = searchTerm.toLowerCase();
                filteredPrompts = filteredPrompts.filter(p =>
                    (p.title && p.title.toLowerCase().includes(lowerCaseSearchTerm)) ||
                    (p.desc && p.desc.toLowerCase().includes(lowerCaseSearchTerm))
                );
            }

            // 3. Paginate
            const totalPages = Math.ceil(filteredPrompts.length / itemsPerPage);
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const paginatedPrompts = filteredPrompts.slice(startIndex, endIndex);

            // 4. Render prompts
            promptListEl.innerHTML = '';
            if (paginatedPrompts.length > 0) {
                paginatedPrompts.forEach(promptData => {
                    const originalIndex = allPrompts.findIndex(p => p === promptData);
                    const card = createPromptCard(promptData, originalIndex);
                    promptListEl.appendChild(card);
                });
            } else {
                promptListEl.innerHTML = '<p class="text-gray-500 col-span-full text-center">표시할 프롬프트가 없습니다.</p>';
            }

            // 5. Render pagination
            renderPagination(totalPages);
        };

        // --- Helper Functions ---
        const createPromptCard = (data, index) => {
            const card = document.createElement('div');
            card.className = "bg-white rounded-lg shadow p-6 flex flex-col";
            card.innerHTML = `
                <div class="flex-grow">
                    <div class="flex justify-between items-start">
                        <h3 data-index="${index}" class="view-btn text-xl font-bold text-orange-600 mb-2 cursor-pointer hover:underline">${data.title || '제목 없음'}</h3>
                        <p class="text-sm text-gray-500 bg-gray-100 px-2 py-1 rounded-full">${data.category}</p>
                    </div>
                    <p class="text-gray-700 mb-4 h-12 overflow-hidden">${data.desc || '설명 없음'}</p>
                </div>
                <div class="flex justify-end gap-2 mt-4">
                    <button data-index="${index}" class="edit-btn text-sm text-blue-600 hover:bg-blue-50 px-3 py-1 rounded">수정</button>
                    <button data-index="${index}" class="delete-btn text-sm text-red-600 hover:bg-red-50 px-3 py-1 rounded">삭제</button>
                </div>
            `;
            return card;
        };

        const renderPagination = (totalPages) => {
            paginationEl.innerHTML = '';
            if (totalPages <= 1) return;

            for (let i = 1; i <= totalPages; i++) {
                const pageBtn = document.createElement('button');
                pageBtn.textContent = i;
                pageBtn.className = `px-3 py-1 rounded-md text-sm ${currentPage === i ? 'bg-orange-600 text-white' : 'bg-white text-gray-700 hover:bg-gray-100'}`;
                pageBtn.onclick = () => {
                    currentPage = i;
                    render();
                };
                paginationEl.appendChild(pageBtn);
            }
        };

        const loadAndRender = () => {
            allPrompts = JSON.parse(localStorage.getItem('promptList') || '[]');
             // 데이터 로드 후 reverse()를 사용하여 초기 정렬을 유지합니다.
            allPrompts = allPrompts.reverse();
            // allPrompts.reverse(); // Show newest first


            render();
        };

        const savePrompts = () => {
            // 저장 시에는 다시 원래 순서(오래된 것이 위)로 되돌려서 저장합니다.
            localStorage.setItem('promptList', JSON.stringify(allPrompts.slice().reverse()));
        };

        // --- Event Listeners ---
        categoryListEl.addEventListener('click', (e) => {
            if (e.target.matches('.category-box')) {
                // 모든 버튼에서 active 클래스 제거
                categoryListEl.querySelectorAll('.category-box').forEach(btn => {
                    btn.classList.remove('active');
                });
                // 클릭된 버튼에 active 클래스 추가
                e.target.classList.add('active');

                currentCategory = e.target.dataset.category;
                currentPage = 1; // 카테고리 변경 시 1페이지로 리셋
                render();
            }
        });

        searchInput.addEventListener('input', (e) => {
            searchTerm = e.target.value;
            currentPage = 1; // 검색 시 1페이지로 리셋
            render();
        });

        promptListEl.addEventListener('click', (e) => {
            const index = e.target.dataset.index;
            if (index === undefined) return;

            if (e.target.matches('.edit-btn')) {
                const promptData = allPrompts[index];
                editModalIndexInput.value = index;
                editModalTitleInput.value = promptData.title;
                editModalDescInput.value = promptData.desc;
                editModalCategoryInput.value = promptData.category;
                editModalBodyInput.value = promptData.body;
                editModal.classList.add('show');
            } else if (e.target.matches('.delete-btn')) {
                deleteIndex = index;
                deleteModalItemTitle.textContent = `"${allPrompts[index].title}"`;
                deleteConfirmModal.classList.add('show');
            } else if (e.target.matches('.view-btn')) {
                const promptData = allPrompts[index];
                viewModalTitle.textContent = promptData.title;
                viewModalCategory.textContent = promptData.category;
                viewModalDesc.textContent = promptData.desc;
                viewModalBody.textContent = promptData.body;
                viewModal.classList.add('show');
            }
        });

        editModalSaveBtn.addEventListener('click', () => {
            const index = editModalIndexInput.value;
            allPrompts[Number(index)] = {
                title: editModalTitleInput.value,
                desc: editModalDescInput.value,
                category: editModalCategoryInput.value,
                body: editModalBodyInput.value,
            };
            savePrompts();
            editModal.classList.remove('show');
            render();
        });



        viewModalCloseBtn.addEventListener('click', () => viewModal.classList.remove('show'));

        editModalCancelBtn.addEventListener('click', () => editModal.classList.remove('show'));

        deleteModalConfirmBtn.addEventListener('click', () => {
            if (deleteIndex !== null) {
                allPrompts.splice(deleteIndex, 1);
                savePrompts();
                deleteConfirmModal.classList.remove('show');
                deleteIndex = null;
                render();
            }
        });

        deleteModalCancelBtn.addEventListener('click', () => {
            deleteConfirmModal.classList.remove('show');
            deleteIndex = null;
        });

        // Initial Load
        loadAndRender();
    });


  </script>

  <script>includeHTML();</script>
</body>





</html>
